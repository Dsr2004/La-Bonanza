{% extends 'base.html' %}
{% load jsonify %}
{% load static %}
{% block titulo %}Crear Estudiante{% endblock titulo %}
{% block estilos %}
<link rel="stylesheet" href="{% static 'libs/datepicker/dist/datepicker.css' %}">

<style>
    input{border: 1px solid #dadce0;border-radius: 4px;box-shadow: 0 0 0 transparent;font-size: 16px;line-height: 17px;outline: transparent;padding: 11px 16px;transition: border .3s, box-shadow .3s;width: 100%;}
    select{border: 1px solid #dadce0;border-radius: 4px;box-shadow: 0 0 0 transparent;font-size: 17px;line-height: 24px;outline: transparent;padding: 11px 16px;transition: border .3s, box-shadow .3s;width: 100%;}
    .formulario{display: grid;grid-template-columns:repeat(2, 1fr);grid-gap:30px;}
    .checkbox{display: grid;grid-template-columns: 80% 20%;}
    @media (max-width: 700px) {.formulario{display: grid;grid-template-columns:repeat(1, 1fr);grid-gap:30px;}}
</style>{% endblock estilos %}
{% block contenido %}
<div class="container-fluid">
    <form action="{% url 'registrarEstudiante' %}" method="post" enctype="multipart/form-data" id="CrearEstudianteForm">
        <h1>Registro Estudiante</h1>
        <br>
        <div class="formulario">
            {% csrf_token %}
            <div>
                <label for="" style="font-weight: 500;">{{form.nombre_completo.label}}:</label>
                {{form.nombre_completo}}
                <p id="nombre_completo" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.fecha_nacimiento.label}}:</label>
                {{form.fecha_nacimiento}}
                <p id="fecha_nacimiento" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.documento.label}}:</label>
                {{form.documento}}
                <p id="documento" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.celular.label}}:</label>
                {{form.celular}}
                <p id="celular" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.telefono.label}}:</label>
                {{form.telefono}}
                <p id="telefono" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.email.label}}:</label>
                {{form.email}}
                <p id="email" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.direccion.label}}:</label>
                {{form.direccion}}
                <p id="direccion" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.barrio.label}}:</label>
                {{form.barrio}}
                <p id="barrio" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.ciudad.label}}:</label>
                {{form.ciudad}}
                <p id="ciudad" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.seguro_medico.label}}:</label>
                {{form.seguro_medico}}
                <p id="seguro_medico" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.documento_identidad.label}}:</label>
                {{form.documento_identidad}}
                <p id="documento_identidad" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.nombre_completo_acudiente.label}}:</label>
                {{form.nombre_completo_acudiente}}
                <p id="nombre_completo_acudiente" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.cedula_acudiente.label}}:</label>
                {{form.cedula_acudiente}}
                <p id="cedula_acudiente" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.lugar_expedicion_acudiente.label}}:</label>
                {{form.lugar_expedicion_acudiente}}
                <p id="lugar_expedicion_acudiente" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.celular_acudiente.label}}:</label>
                {{form.celular_acudiente}}
                <p id="celular_acudiente" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.email_acudiente.label}}:</label>
                {{form.email_acudiente}}
                <p id="email_acudiente" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.nombre_contactoE.label}}:</label>
                {{form.nombre_contactoE}}
                <p id="nombre_contactoE" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.telefono_contactoE.label}}:</label>
                {{form.telefono_contactoE}}
                <p id="telefono_contactoE" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.relacion_contactoE.label}}:</label>
                {{form.relacion_contactoE}}
                <p id="relacion_contactoE" class="error_text"></p>
            </div>
            <div>
                <label for="" style="font-weight: 500;">{{form.tipo_clase.label}}:</label>
                {{form.tipo_clase}}
                <p id="tipo_clase" class="error_text"></p>
            </div>
            <script>
                console.log($('#id_tipo_clase'))
                let campos = document.querySelectorAll("input");
                let selects = document.querySelectorAll("select");
                selects.forEach(function(select) {
                    select.setAttribute("class", "form-control");
                });
                campos.forEach(function(campo) {
                    campo.setAttribute("class", "form-control");
                    if (campo.getAttribute('type')=="checkbox") {
                        campo.classList.remove("form-control");
                        campo.previousSibling.remove();
                        campo.parentNode.classList.add("checkbox");
                        campo.parentNode.childNodes[1].style.marginTop = "5px"
                        campo.style.height = "32px";
                    }
                }); 
            </script>
        </div>
        <hr>
        <h5>Documentos</h5>
       <div class="row">
        <div class="col-md-6">
            <div class="bodyFile">
                <div class="containerFile">
                    <h3>Documento</h3>
                    <div class="drag-areaDocumento">
                        <div class="icon"><i class="fas fa-images"></i></div>
                        <span class="headerDocumento">Arrastra y Suelta</span>
                        <span class="headerDocumento">o <span class="buttonDragDocumento">Selecciónalo</span></span>
                        <span class="support">Soporta: JPEG, JPG, PNG, PDF</span>
                    </div>
                </div>
            </div>
            <input type="file" hidden name="documento_A" id="id_documento_A">
            <p id="documento_A" class="error_text"></p>
        </div>
        <div class="col-md-6">
            <div class="bodyFile">
                <div class="containerFile">
                    <h3>EPS</h3>
                    <div class="drag-area">
                        <div class="icon"><i class="fas fa-images"></i></div>
                        <span class="header">Arrastra y Suelta</span>
                        <span class="header">o <span class="buttonDrag">Selecciónalo</span></span>
                        <span class="support">Soporta: JPEG, JPG, PNG, PDF</span>
                    </div>
                </div>
            </div>
            <input type="file" hidden name="seguro_A" id="id_seguro_A">
            <p id="seguro_A" class="error_text"></p>
        </div>
       </div>
       <br>
       {% comment %}
       <div class="col-md-12">
        <span class="d-block pb-2">Firma digital aqui</span>
        <div class="signature mb-2" style="width: 100%; height: 200px;">
            <canvas id="signature-canvas"
                style="border: 1px dashed red; width: 100%; height: 200px;"></canvas>
        </div>
        <button type="button" onclick="limpiarFirma()">Limpiar</button>
        <p id="firma" class="error_text"></p>
        <br>
    </div>

       {% endcomment %}
       <div>
        <label for="" style="font-weight: 500;">{{form.firma.label}}:</label>
        <br>{{form.firma}}<br>
        <p id="" class="error_text"></p>
    </div>
       <br>
        <button type="submit" class="btn btn-success w-100" style="float: right">Enviar</button>
        <br><br><br>
    </form>
</div>
{% endblock contenido %}


{% block scripts %}
{% if form.errors %}
    <script>
        let errores = '{{form.errors|jsonify}}'
        errores = JSON.parse(errores)
        let form = $("#CrearEstudianteForm")
        form.find('.error_text').text('');
        form.find('.is-invalid').removeClass('is-invalid');
        for (let i in errores){
            let x=form.find('input[name='+i+']')
            let y=form.find('select[name='+i+']')
            x.addClass("is-invalid")
            y.addClass("is-invalid")
            $("#"+i).text(errores[i])
        }
        
    </script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>

<script>
    window.addEventListener('load', async () => {
        const canvas = document.querySelector("canvas");
        canvas.height = canvas.offsetHeight;
        canvas.width = canvas.offsetWidth;

        signaturePad = new SignaturePad(canvas, {});
});

function limpiarFirma(){
    signaturePad.clear();
}

// $("#CrearEstudianteForm").submit(function(event){
//     event.preventDefault()
//     if(signaturePad.isEmpty()){
//         alert("esta vacio")
//     }else{
//         const canvas = $('#signature-canvas')
//         let img = signaturePad.toDataURL();
       
//     }
    
// })


</script>
<script>
    const dragArea = $(".drag-area");
    const dragTetxt = document.querySelector(".header")
    const dragAreaDoc = $(".drag-areaDocumento");
    const dragTetxtDoc = document.querySelector(".headerDocumento")
    let file;
    let buttonDocumento = document.querySelector(".buttonDragDocumento")
    let inputDocumento = document.querySelector("#id_documento_A")
    let buttonSeguro = document.querySelector(".buttonDrag")
    let inputSeguro = document.querySelector("#id_seguro_A")

    buttonDocumento.onclick = () =>{
        inputDocumento.click()
    }
    buttonSeguro.onclick = () =>{
        inputSeguro.click()
    }

    inputDocumento.addEventListener("change",function(){
    file = this.files[0]
    dragArea.addClass("active")
    displayFile(dragAreaDoc)
    })
    inputSeguro.addEventListener("change",function(){
    file = this.files[0]
    console.log(file)
    dragArea.addClass("active")
    displayFile(dragArea)
    })
    
    // DOCUMENTO-------------
        // cuando entra la imagen
        dragAreaDoc.on("dragover", function(event) {
        event.preventDefault();  
        event.stopPropagation();
        dragTetxtDoc.textContent = "Listo para subir"
        dragAreaDoc.addClass("active")
        // console.log("entro al drag")
        });
        // cuando esta fuera
        dragAreaDoc.on("dragleave", function() {
            dragTetxtDoc.textContent = "Arrastra y Suelta"
            dragAreaDoc.removeClass("active")
            // console.log("salio del drag")
        });

        dragAreaDoc.on("drop", function(event) {
            event.preventDefault();  
            file = event.originalEvent.dataTransfer.files[0]
            console.log(file)
            displayFile(dragAreaDoc)
        });

    // EPS------------------
        // cuando entra la imagen
        dragArea.on("dragover", function(event) {
        event.preventDefault();  
        event.stopPropagation();
        dragTetxt.textContent = "Listo para subir"
        dragArea.addClass("active")
        // console.log("entro al drag")
        });
        // cuando esta fuera
        dragArea.on("dragleave", function() {
            dragTetxt.textContent = "Arrastra y Suelta"
            dragArea.removeClass("active")
            // console.log("salio del drag")
        });

        dragArea.on("drop", function(event) {
            event.preventDefault();  
            file = event.originalEvent.dataTransfer.files[0]
            console.log(event)
            displayFile(dragArea)
        });

    

    function displayFile(drag){
        let fileType = file.type
        let validExtensions = ["image/jpeg", "image/jpg", "image/png", "application/pdf"]
        if (validExtensions.includes(fileType)){
            let fileReader = new FileReader()
            fileReader.onload=()=>{
                let fileURL = fileReader.result
                let imgTag = '<img src="'+fileURL+'" alt="">'
                drag.html(imgTag)
            };
            fileReader.readAsDataURL(file)
        }else{
            Swal.fire(
            'TIPO DE ARCHIVO INVÁLIDO',
            'Solo se pueden adjuntar imÁgenes JPG, JPEG, PNG y archivos PDF',
            'error'
            )
            drag.removeClass("active")
        }
        console.log(fileType)
        // console.log("solto el archivo")
    }

</script>

<script src="{% static 'libs/datepicker/dist/datepicker.js' %}"></script>
<script src="{% static 'libs/datepicker/i18n/datepicker.es-ES.js' %}"></script>
    <!-- <script>
         $("#id_fecha_nacimiento").datepicker({
            language: 'es-ES',
            format: "dd/mm/YYYY",
            autoHide: true,
            
        });
    </script> -->

{% endblock scripts %}