{% extends 'base.html' %}
{% load static %}
{% load jsonify %}
{% block titulo %}Crear Estudiante{% endblock titulo %}
{% block estilos %}
<link rel="stylesheet" href="{% static 'libs/datepicker/dist/datepicker.css' %}">

<style>
    input{border: 1px solid #dadce0;border-radius: 4px;box-shadow: 0 0 0 transparent;font-size: 16px;line-height: 17px;outline: transparent;padding: 11px 16px;transition: border .3s, box-shadow .3s;width: 100%;}
    select{border: 1px solid #dadce0;border-radius: 4px;box-shadow: 0 0 0 transparent;font-size: 17px;line-height: 24px;outline: transparent;padding: 11px 16px;transition: border .3s, box-shadow .3s;width: 100%;}
    .formulario{display: grid;grid-template-columns:repeat(2, 1fr);grid-gap:30px;}
    .checkbox{display: grid;grid-template-columns: 80% 20%;}
    @media (max-width: 700px) {.formulario{display: grid;grid-template-columns:repeat(1, 1fr);grid-gap:30px;}}
</style>{% endblock estilos %}
{% block contenido %}
<div class="container-fluid">
    <form action="{% url 'registrarEstudiante' %}" method="post" enctype="multipart/form-data" id="CrearEstudianteForm">
        {% csrf_token %}
        <br>
        <h1><center>Registro Estudiante</center></h1>
        <br>
        <div class="container">
            <ul class="nav nav-pills mb-3" id="pills-tab" role="tablist">
                <li class="nav-item" role="presentation">
                  <button class="nav-link active" id="pills-home-tab" data-bs-toggle="pill" data-bs-target="#pills-home" type="button" role="tab" aria-controls="pills-home" aria-selected="true">Estudiante</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="pills-profile-tab" data-bs-toggle="pill" data-bs-target="#pills-profile" type="button" role="tab" aria-controls="pills-profile" aria-selected="false">Padres</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="pills-contact-tab" data-bs-toggle="pill" data-bs-target="#pills-contact" type="button" role="tab" aria-controls="pills-contact" aria-selected="false">Contacto de Emergencia</button>
                </li>
                <li class="nav-item" role="presentation">
                  <button class="nav-link" id="pills-disabled-tab" data-bs-toggle="pill" data-bs-target="#pills-disabled" type="button" role="tab" aria-controls="pills-disabled" aria-selected="false">Documentos</button>
                </li>
              </ul>
              <div class="tab-content" id="pills-tabContent">
                <div class="tab-pane fade show active" id="pills-home" role="tabpanel" aria-labelledby="pills-home-tab" tabindex="0">
                    <h3>Información del estudiante</h3>
                    <hr>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.nombre_completo.label}}:</label>
                            {{form.nombre_completo}}
                            <p id="nombre_completo" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.fecha_nacimiento.label}}:</label>
                            {{form.fecha_nacimiento}}
                            <p id="fecha_nacimiento" class="error_text"></p>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.documento.label}}:</label>
                            {{form.documento}}
                            <p id="documento" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.celular.label}}:</label>
                            {{form.celular}}
                            <p id="celular" class="error_text"></p>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.email.label}}:</label>
                            {{form.email}}
                            <p id="email" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.direccion.label}}:</label>
                            {{form.direccion}}
                            <p id="direccion" class="error_text"></p>
                        </div>
                    </div>
                   <br>
                   <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.barrio.label}}:</label>
                            {{form.barrio}}
                            <p id="barrio" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.ciudad.label}}:</label>
                            {{form.ciudad}}
                            <p id="ciudad" class="error_text"></p>
                        </div>
                   </div>
                   <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.seguro.label}}:</label>
                            {{form.seguro}}
                            <p id="seguro" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.poliza.label}}:</label>
                            {{form.poliza}}
                            <p id="poliza" class="error_text"></p>
                        </div>
                    </div>
                    <br>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.comprobante_seguro_medico.label}}:</label>
                            {{form.comprobante_seguro_medico}}
                            <p id="comprobante_seguro_medico" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.comprobante_documento_identidad.label}}:</label>
                            {{form.comprobante_documento_identidad}}
                            <p id="comprobante_documento_identidad" class="error_text"></p>
                        </div>
                    </div>
                
                </div>
                <div class="tab-pane fade" id="pills-profile" role="tabpanel" aria-labelledby="pills-profile-tab" tabindex="0">
                    <h3>Información de los padres</h3>
                    <hr>
                    <h5><center>Información de la Madre</center></h5>
                    <div>
                        <label for="" style="font-weight: 500;">{{form.nombre_completo_madre.label}}:</label>
                        {{form.nombre_completo_madre}}
                        <p id="nombre_completo_madre" class="error_text"></p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.cedula_madre.label}}:</label>
                            {{form.cedula_madre}}
                            <p id="cedula_madre" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.lugar_expedicion_madre.label}}:</label>
                            {{form.lugar_expedicion_madre}}
                            <p id="lugar_expedicion_madre" class="error_text"></p>
                        </div>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.celular_madre.label}}:</label>
                            {{form.celular_madre}}
                            <p id="celular_madre" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.email_madre.label}}:</label>
                            {{form.email_madre}}
                            <p id="email_madre" class="error_text"></p>
                        </div>
                    </div>
                    <h5><center>Información del Padre</center></h5>
                    <div>
                        <label for="" style="font-weight: 500;">{{form.nombre_completo_padre.label}}:</label>
                        {{form.nombre_completo_padre}}
                        <p id="nombre_completo_padre" class="error_text"></p>
                    </div>
                    <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.cedula_padre.label}}:</label>
                            {{form.cedula_padre}}
                            <p id="cedula_padre" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.lugar_expedicion_padre.label}}:</label>
                            {{form.lugar_expedicion_padre}}
                            <p id="lugar_expedicion_padre" class="error_text"></p>
                        </div>
                    </div>
                   <div class="row">
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.celular_padre.label}}:</label>
                            {{form.celular_padre}}
                            <p id="celular_padre" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.email_padre.label}}:</label>
                            {{form.email_padre}}
                            <p id="email_padre" class="error_text"></p>
                        </div>
                   </div>
                   <br>
                   <h4>Información de ubicacion de los padres</h4>
                   <div class="row">
                    <div class="col-md-6">
                        <label for="" style="font-weight: 500;">{{form.direccion.label}}:</label>
                        {{form.direccion}}
                        <p id="direccion" class="error_text"></p>
                        </div>
                        <div class="col-md-6">
                            <label for="" style="font-weight: 500;">{{form.barrio.label}}:</label>
                            {{form.barrio}}
                            <p id="barrio" class="error_text"></p>
                        </div>
                   </div>
                    <div>
                        <label for="" style="font-weight: 500;">{{form.ciudad.label}}:</label>
                        {{form.ciudad}}
                        <p id="ciudad" class="error_text"></p>
                    </div>
                </div>
                <div class="tab-pane fade" id="pills-contact" role="tabpanel" aria-labelledby="pills-contact-tab" tabindex="0">
                    <div>
                        <label for="" style="font-weight: 500;">{{form.nombre_contactoE.label}}:</label>
                        {{form.nombre_contactoE}}
                        <p id="nombre_contactoE" class="error_text"></p>
                    </div>
                    <div>
                        <label for="" style="font-weight: 500;">{{form.telefono_contactoE.label}}:</label>
                        {{form.telefono_contactoE}}
                        <p id="telefono_contactoE" class="error_text"></p>
                    </div>
                    <div>
                        <label for="" style="font-weight: 500;">{{form.relacion_contactoE.label}}:</label>
                        {{form.relacion_contactoE}}
                        <p id="relacion_contactoE" class="error_text"></p>
                    </div>
                </div>
                <div class="tab-pane fade" id="pills-disabled" role="tabpanel" aria-labelledby="pills-disabled-tab" tabindex="0">
                    <h3>Documentos del estudiante</h3>
        <div class="row">
                <div class="col-md-6">
                    {{form.documento_A}}
                    <p id="documento_A" class="error_text"></p>
                </div>
                <div class="col-md-6">
                    {{form.seguro_A}}
                    <p id="seguro_A" class="error_text"></p>
                </div>
                <div>
                    <label for="" style="font-weight: 500;">{{form.firma.label}}:</label>
                    <br>{{form.firma}}<br>
                    <p id="" class="error_text"></p>
                </div>
                   <br>
                <div>
                    <label for="" style="font-weight: 500;">{{form.tipo_clase.label}}:</label>
                    {{form.tipo_clase}}
                    <p id="tipo_clase" class="error_text"></p>
                </div>
        </div>
       <br>
       {% comment %}
       <div class="col-md-12">
        <span class="d-block pb-2">Firma digital aqui</span>
        <div class="signature mb-2" style="width: 100%; height: 200px;">
            <canvas id="signature-canvas"
                style="border: 1px dashed red; width: 100%; height: 200px;"></canvas>
        </div>
        <button type="button" onclick="limpiarFirma()">Limpiar</button>
        <p id="firma" class="error_text"></p>
        <br>
    </div>

       {% endcomment %}
       
        <button type="submit" class="btn btn-success w-100" style="float: right">Enviar</button>
                </div>
              </div>
            <!-- ------------------- -->

           
           
            <script>
                console.log($('#id_tipo_clase'))
                let campos = document.querySelectorAll("input");
                let selects = document.querySelectorAll("select");
                selects.forEach(function(select) {
                    select.setAttribute("class", "form-control");
                });
                campos.forEach(function(campo) {
                    campo.setAttribute("class", "form-control");
                    if (campo.getAttribute('type')=="checkbox") {
                        campo.classList.remove("form-control");
                        campo.previousSibling.remove();
                        campo.parentNode.classList.add("checkbox");
                        campo.parentNode.childNodes[1].style.marginTop = "5px"
                        campo.style.height = "32px";
                    }
                }); 
            </script>
        </div>

        <br><br><br>
    </form>
</div>
{% endblock contenido %}


{% block scripts %}
{% if form.errors %}
    <script>
        let errores = '{{form.errors|jsonify}}'
        errores = JSON.parse(errores)
        let form = $("#CrearEstudianteForm")
        form.find('.error_text').text('');
        form.find('.is-invalid').removeClass('is-invalid');
        for (let i in errores){
            let x=form.find('input[name='+i+']')
            let y=form.find('select[name='+i+']')
            x.addClass("is-invalid")
            y.addClass("is-invalid")
            $("#"+i).text(errores[i])
        }
        
    </script>
{% endif %}

<script src="https://cdn.jsdelivr.net/npm/signature_pad@2.3.2/dist/signature_pad.min.js"></script>
<!--  
<script>
//     window.addEventListener('load', async () => {
//         const canvas = document.querySelector("canvas");
//         canvas.height = canvas.offsetHeight;
//         canvas.width = canvas.offsetWidth;

//         signaturePad = new SignaturePad(canvas, {});
// });

// function limpiarFirma(){
//     signaturePad.clear();
// }

// $("#CrearEstudianteForm").submit(function(event){
//     event.preventDefault()
//     if(signaturePad.isEmpty()){
//         alert("esta vacio")
//     }else{
//         const canvas = $('#signature-canvas')
//         let img = signaturePad.toDataURL();
       
//     }
    
// })


</script>
-->
<script>

    function displayFile(drag){
        let fileType = file.type
        let validExtensions = ["image/jpeg", "image/jpg", "image/png", "application/pdf"]
        if (validExtensions.includes(fileType)){
            let fileReader = new FileReader()
            fileReader.onload=()=>{
                let fileURL = fileReader.result
                let imgTag = '<img src="'+fileURL+'" alt="">'
                drag.html(imgTag)
            };
            fileReader.readAsDataURL(file)
        }else{
            Swal.fire(
            'TIPO DE ARCHIVO INVÁLIDO',
            'Solo se pueden adjuntar imÁgenes JPG, JPEG, PNG y archivos PDF',
            'error'
            )
            drag.removeClass("active")
        }
        console.log(fileType)
        // console.log("solto el archivo")
    }

</script>

<script src="{% static 'libs/datepicker/dist/datepicker.js' %}"></script>
<script src="{% static 'libs/datepicker/i18n/datepicker.es-ES.js' %}"></script>

{% endblock scripts %}