{% extends 'base.html' %}
{% load static %}
{% block titulo %}Calendario{% endblock titulo %}

{% block estilos %}
<link rel="stylesheet" href="{% static 'libs/fullcalendar/lib/main.css' %}">
<link rel="stylesheet" href="{% static 'libs/daterangepicker/daterangepicker.css' %}">
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-ka7Sk0Gln4gmtz2MlQnikT1wXgYsOg+OMhuP+IlRH9sENBO0LRn5q+8nbTov4+1p" crossorigin="anonymous"></script>
<link rel="stylesheet" href="{% static 'css/estilosBase.css' %}">
<style>
    .titulo_calendar{
        font-size: 35px;
        font-weight: 700;
    }
</style>
{% endblock estilos %}


{% block contenido %}
<br>
<div class="text-center mostrar"  id="spinnerLoad">
    <div class="spinner-grow " style="width: 3rem; height: 3rem;" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
    <h4 id="titleSpinner">Cargando clases... <br> <sub>Espere un momento por favor</sub></h4>
</div>


<div class="container mt-4 cont_list">
    <div id="box" class="ocultar" >
        <div class="container mb-3">
            <div class="row justify-content-between">
                <div class="col-7">
                    <p class="titulo_calendar">Calendario de clases</p>
                </div>
                <div class="col-5" style="float: left; text-align: end;">
                    <div class="row">
                        <div class="{%if cancelada > 0 %}col-6{%else%}col-12{%endif%} mb-2">
                            <a href="{% url 'asistencia' %}" class="btn btn-outline-secondary w-100">Gestionar asistencia &nbsp; <i class="fa-solid fa-users"></i></a>
                        </div>
                        <div class="col-12">
                            <a href="{% url 'clasesCanceladas' %}" style="display: {%if cancelada > 0 %}block{%else%}none{%endif%};" class="btn btn-danger w-100">Clases de reprogramaci√≥n &nbsp; <i class="fa-solid fa-clock"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </div>   
    </div>
    <div id="calendar" style="padding: 40px; visibility: hidden;" class="ocultar"></div>
    <div id="reloadPage"></div>
   
    
    <div class="modal fade" id="ModalInfoEstudianteCalendario" tabindex="-1" aria-labelledby="exampleModalLabel" aria-hidden="true"></div>x
    
</div>
    

{% endblock contenido %}



{% block scripts %}
<script src="{% static 'libs/fullcalendar/lib/main.js' %}"></script>
<script src="{% static 'libs/fullcalendar/lib/locales-all.js' %}"></script>
<script src="{% static 'libs/daterangepicker/moment.min.js' %}"></script>
<script src="{% static 'libs/daterangepicker/daterangepicker.js' %}"></script>

<script>


    function removeLoader(){
        let spinner = $("#spinnerLoad")
        let box = $("#box")
        let calendario = $("#calendar")


        spinner.removeClass("mostrar")
        spinner.addClass("ocultar")

        box.removeClass("ocultar")
        box.addClass("mostrar")

        calendario.css("visibility", "visible ")

    }

    
    document.addEventListener("DOMContentLoaded", function(){
        console.log("{{fecha|date:'Y-m-d'}}")
        var CalenadrUI = document.getElementById("calendar")
        var calendar = new FullCalendar.Calendar(CalenadrUI,{
            dateClick: function(info) {
                let url = '{%url "horario" 7%}'
                url =  url.substr(0, url.length - 1)
                window.location.href = url+info.dateStr
            },
            initialDate:   "{{fecha|date:'Y-m-d'}}",
            eventTimeFormat: { 
                hour: '2-digit',
                minute: '2-digit',
                hour12: true
            },
            headerToolbar: {
                start: 'title', // will normally be on the left. if RTL, will be on the right
                center: '',
                end: 'today prev,next' // will normally be on the right. if RTL, will be on the left
            },
            events: [
            {%for clase in clases %}
                {
                id: '{%url 'verInfoEstudianteCalendario' clase.pk%}',
                title : '{{clase.clase.calendario.registro.get_estudiante}}',
                start: '{{clase.get_date_time}}',
               
                color: '{{clase.clase.calendario.registro.nivel.color_fondo}}',
                textColor: '{{clase.clase.calendario.registro.nivel.color_letra}}',

                display: 'auto',
                },
                
            {%endfor%}

            ],
            eventClick: function(arg) {
            abrir_modal_calendario(arg.event.id)
      },
        })
       
        calendar.render();
        calendar.setOption('locale','es')
      
        var box = document.getElementById("reloadPage")
        $('.fc-prev-button').click(function(){
            var date = calendar.getDate().toLocaleDateString("en-US");
            let form = document.createElement("form")
            form.method="GET"
            let input = document.createElement("input")
            input.name="fecha"
            input.value=date
            form.appendChild(input)
            box.appendChild(form)
            form.submit()
    });

    $('.fc-next-button').click(function(){
        var date = calendar.getDate().toLocaleDateString("en-US");
            let form = document.createElement("form")
            form.method="GET"
            let input = document.createElement("input")
            input.name="fecha"
            input.value=date
            form.appendChild(input)
            box.appendChild(form)
            form.submit()
    });

    })
</script>
<script>
    $(window).on("load", function () {
       setTimeout(removeLoader(), 2000)
    
    })
</script>
{% endblock scripts %}

